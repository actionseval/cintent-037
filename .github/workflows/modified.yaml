name: Build & Test

# CINTENT >> MANUAL_TRIGGER
# on:
#   push:
#   pull_request:
#   workflow_call:
on: [repository_dispatch, workflow_dispatch]

jobs:
  # CINTENT >> NO_TRACEE
  # lint:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout the repository
  #       uses: actions/checkout@v3
  #     - name: Run black
  #       uses: psf/black@stable
  #       with:
  #         src: "./melusine"

  # CINTENT >> NOT_CI
  # pre-commit:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - name: Checkout the repository
  #     uses: actions/checkout@v3
  #   - name: Set up Python ${{ matrix.python-version }}
  #     uses: actions/setup-python@v4
  #   - name: Run pre-commit
  #     uses: pre-commit/action@v3.0.0

  test:
    name: Test
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      max-parallel: 2
      matrix:
        # CINTENT >> REMOVE_MATRIX
        # python-version: ["3.8", "3.9", "3.10", "3.11", "3.12"]
        python-version: ["3.12"]
    steps:
    - name: Checkout the repository
      uses: actions/checkout@v3

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    # CINTENT >> INSERT_CINTENT
    - uses: JavidDitty/setup-cintent@3e5b2faf83a2ad32c22a1cd0f86f5f20ea53a5ab

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install tox tox-gh-actions

    - name: Test with tox
      run: tox

    # CINTENT >> INSERT_CINTENT
    - name: Upload CIntent Artifacts
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ${{ env.CINTENT_ARTIFACT_NAME }}
        path: ${{ env.CINTENT_LOGS }}
